<?php
	require __DIR__.'/classes/user.php';
	require __DIR__.'/components/connection.php';
	
	$user = new User();
	$loggedIn = False;
	$isAdmin = False;
	try {
		$loggedIn = $user->sessionLogin();
		$isAdmin = $user->isAdmin();
	} catch(Exception $exception) {
		error();
	}
	
	if (!$loggedIn) {
		header("Location: login.php");
		die();
	}
	
	$header_title = "Homepage";
	require __DIR__.'/components/header.php';
?>
<main>
	<p id="welcome-message">
		<?php
			echo 'Welcome, ' . $user->getFirstName() . ' ';
			if ($isAdmin) {
				echo '<span>Admin</span>';
			}
		?>
	</p>
	<form name="logoutForm" action="./logout.php" method="POST">
		<button type="submit" name="action" value="logout">
		Logout
		</button>
	</form>
	<hr>
	<?php
		$rssFeed = file_get_contents("https://rss.packetstormsecurity.com/news/");
		
		$rss = new SimpleXMLElement($rssFeed);
		
		echo "<ul>";
		foreach($rss->channel->item as $entry){
			echo "<li>" . $entry->pubDate . " <a href='$entry->link' title='$entry->title'>" . $entry->title . "</a></li>";
		}
		echo "</ul>";
	?>
</main>

<?php
	require __DIR__.'/components/footer.php';
?>
